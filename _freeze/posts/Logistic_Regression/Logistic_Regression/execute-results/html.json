{
  "hash": "761ffa5b3b89524f787f0e2f742112a0",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Logistic regression\"\nauthor: Jinii\ndate: '2024-09-010'\ncategories: [bigdata]\njupyter: python3\n---\n\n\nì¢…ì†ë³€ìˆ˜: ë°±í˜ˆë³‘ ì„¸í¬ ê´€ì¸¡ ë¶ˆê°€ ì—¬ë¶€ (REMISS), 1ì´ë©´ ê´€ì¸¡ ì•ˆë¨ì„ ì˜ë¯¸\n\në…ë¦½ë³€ìˆ˜:\nê³¨ìˆ˜ì˜ ì„¸í¬ì„± (CELL)\nê³¨ìˆ˜í¸ì˜ ë°±í˜ˆêµ¬ ë¹„ìœ¨ (SMEAR)\nê³¨ìˆ˜ì˜ ë°±í˜ˆë³‘ ì„¸í¬ ì¹¨íˆ¬ ë¹„ìœ¨ (INFIL)\nê³¨ìˆ˜ ë°±í˜ˆë³‘ ì„¸í¬ì˜ ë¼ë²¨ë§ ì¸ë±ìŠ¤ (LI)\në§ì´ˆí˜ˆì•¡ì˜ ë°±í˜ˆë³‘ ì„¸í¬ ìˆ˜ (BLAST)\nì¹˜ë£Œ ì‹œì‘ ì „ ìµœê³  ì²´ì˜¨ (TEMP)\n\n## ë¬¸ì œ 1.\n\në°ì´í„°ë¥¼ ë¡œë“œí•˜ê³ , ë¡œì§€ìŠ¤í‹± íšŒê·€ëª¨ë¸ì„ ì í•©í•˜ê³ , íšŒê·€ í‘œë¥¼ ì‘ì„±í•˜ì„¸ìš”.\n\n::: {#8663f378 .cell execution_count=1}\n``` {.python .cell-code}\n# ë°ì´í„° ë¡œë“œ\nimport pandas as pd\n\ndf = pd.read_csv('../../data/leukemia_remission.txt', delim_whitespace= True) # delim_whitespace : ê³µë°± ì§€ìš°ê¸°\nprint(df.head())\n\ntrain = df.drop(columns=('REMISS')) # ë…ë¦½ë³€ìˆ˜ë§Œ\n\n# ë¡œì§€ìŠ¤í‹± íšŒê·€ëª¨ë¸ ì í•©, íšŒê·€ í‘œ ì‘ì„±\nimport statsmodels.api as sm\nmodel = sm.formula.logit(\"REMISS ~ CELL + SMEAR + INFIL + LI + BLAST + TEMP\", data=df).fit()\nprint(model.summary())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   REMISS  CELL  SMEAR  INFIL   LI  BLAST  TEMP\n0       1   0.8   0.83   0.66  1.9   1.10  1.00\n1       1   0.9   0.36   0.32  1.4   0.74  0.99\n2       0   0.8   0.88   0.70  0.8   0.18  0.98\n3       0   1.0   0.87   0.87  0.7   1.05  0.99\n4       1   0.9   0.75   0.68  1.3   0.52  0.98\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nC:\\Users\\USER\\AppData\\Local\\Temp\\ipykernel_2104\\3209557587.py:4: FutureWarning:\n\nThe 'delim_whitespace' keyword in pd.read_csv is deprecated and will be removed in a future version. Use ``sep='\\s+'`` instead\n\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nOptimization terminated successfully.\n         Current function value: 0.399886\n         Iterations 10\n                           Logit Regression Results                           \n==============================================================================\nDep. Variable:                 REMISS   No. Observations:                   27\nModel:                          Logit   Df Residuals:                       20\nMethod:                           MLE   Df Model:                            6\nDate:                Tue, 10 Sep 2024   Pseudo R-squ.:                  0.3718\nTime:                        10:29:30   Log-Likelihood:                -10.797\nconverged:                       True   LL-Null:                       -17.186\nCovariance Type:            nonrobust   LLR p-value:                   0.04670\n==============================================================================\n                 coef    std err          z      P>|z|      [0.025      0.975]\n------------------------------------------------------------------------------\nIntercept     64.2581     74.965      0.857      0.391     -82.670     211.187\nCELL          30.8301     52.135      0.591      0.554     -71.353     133.013\nSMEAR         24.6863     61.526      0.401      0.688     -95.903     145.275\nINFIL        -24.9745     65.281     -0.383      0.702    -152.923     102.974\nLI             4.3605      2.658      1.641      0.101      -0.849       9.570\nBLAST         -0.0115      2.266     -0.005      0.996      -4.453       4.430\nTEMP        -100.1734     77.753     -1.288      0.198    -252.567      52.220\n==============================================================================\n\nPossibly complete quasi-separation: A fraction 0.11 of observations can be\nperfectly predicted. This might indicate that there is complete\nquasi-separation. In this case some parameters will not be identified.\n```\n:::\n:::\n\n\n## ë¬¸ì œ 2.\n\ní•´ë‹¹ ëª¨ë¸ì€ í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•œê°€ìš”? ê·¸ ì´ìœ ë¥¼ ê²€ì •í†µê³„ëŸ‰ë¥¼ ì‚¬ìš©í•´ì„œ ì„¤ëª…í•˜ì‹œì˜¤.\n\n::: {#c781bf6e .cell execution_count=2}\n``` {.python .cell-code}\n# âˆ’2(â„“(ğ›½)Ì‚ (0) âˆ’ â„“(ğ›½)Ì‚ )  =  -2*(-17.186+10.797)  = 12.779\nfrom scipy.stats import chi2\n1 - chi2.cdf(12.779, df=6)  # 0.0466828104726148\n\n# LLR p-value: 0.0467 < ìœ ì˜ìˆ˜ì¤€ 0.05ë³´ë‹¤ ì‘ìœ¼ë‹ˆê¹Œ í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•˜ë‹¤ê³  í•  ìˆ˜ ìˆë‹¤.\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```\nnp.float64(0.0466828104726148)\n```\n:::\n:::\n\n\n## ë¬¸ì œ 3.\n\nìœ ì˜ìˆ˜ì¤€ì´ 0.2ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•œ ë³€ìˆ˜ëŠ” ëª‡ê°œì´ë©°, ì–´ëŠ ë³€ìˆ˜ ì¸ê°€ìš”?\n\n::: {#555c3e6b .cell execution_count=3}\n``` {.python .cell-code}\n# P>|z|ê°€ 0.2ë³´ë‹¤ ì‘ì€ LI, TEMPê°€ ìœ ì˜í•˜ë‹¤\n```\n:::\n\n\n## ë¬¸ì œ 4\n\në‹¤ìŒ í™˜ìì— ëŒ€í•œ ì˜¤ì¦ˆëŠ” ì–¼ë§ˆì¸ê°€ìš”?\n\nCELL (ê³¨ìˆ˜ì˜ ì„¸í¬ì„±): 65%\nSMEAR (ê³¨ìˆ˜í¸ì˜ ë°±í˜ˆêµ¬ ë¹„ìœ¨): 45%\nINFIL (ê³¨ìˆ˜ì˜ ë°±í˜ˆë³‘ ì„¸í¬ ì¹¨íˆ¬ ë¹„ìœ¨): 55%\nLI (ê³¨ìˆ˜ ë°±í˜ˆë³‘ ì„¸í¬ì˜ ë¼ë²¨ë§ ì¸ë±ìŠ¤): 1.2\nBLAST (ë§ì´ˆí˜ˆì•¡ì˜ ë°±í˜ˆë³‘ ì„¸í¬ ìˆ˜): 1.1ì„¸í¬/Î¼L\nTEMP (ì¹˜ë£Œ ì‹œì‘ ì „ ìµœê³  ì²´ì˜¨): 0.9\n\n::: {#ad0b3d6a .cell execution_count=4}\n``` {.python .cell-code}\nimport numpy as np\nlog_odds=64.2581 + 30.8301*0.65 + 24.6863*0.45 + -24.9745*0.55 + 4.3605*1.2 + -0.0115*1.1 + -100.1734*0.9\nodds = np.exp(log_odds) # 0.03817459641135519\nprint(odds)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n0.03817459641135519\n```\n:::\n:::\n\n\n## ë¬¸ì œ 5\n\nìœ„ í™˜ìì˜ í˜ˆì•¡ì—ì„œ ë°±í˜ˆë³‘ ì„¸í¬ê°€ ê´€ì¸¡ë˜ì§€ ì•Šì€ í™•ë¥ ì€ ì–¼ë§ˆì¸ê°€ìš”?\n\n::: {#e0dca07a .cell execution_count=5}\n``` {.python .cell-code}\np_hat = odds / (odds + 1) # 0.03677088280074742\nprint(p_hat)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n0.03677088280074742\n```\n:::\n:::\n\n\n## ë¬¸ì œ 6\n\nTEMP ë³€ìˆ˜ì˜ ê³„ìˆ˜ëŠ” ì–¼ë§ˆì´ë©°, í•´ë‹¹ ê³„ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ TEMP ë³€ìˆ˜ê°€ ë°±í˜ˆë³‘ ì¹˜ë£Œì— ëŒ€í•œ ì˜í–¥ì„ ì„¤ëª…í•˜ì‹œì˜¤.\n\n::: {#dc8ae5d4 .cell execution_count=6}\n``` {.python .cell-code}\nnp.exp(-100.1734)\n# 3.13e-44 - > 0ì— ê°€ê¹Œìš´ ê°’ì…ë‹ˆë‹¤.\n# ì²´ì˜¨ì´ 1ë‹¨ìœ„ ìƒìŠ¹í•  ë•Œ ë°±í˜ˆë³‘ ì„¸í¬ê°€ ê´€ì¸¡ë˜ì§€ ì•Šì„ í™•ë¥ ì´ (ì˜¤ì¦ˆë¹„ë§Œí¼ ë³€ë™)ê±°ì˜ ì—†ì–´ì§€ëŠ” ê²ƒì„ ì˜ë¯¸\n# -> ì˜¨ë„ê°€ ë†’ì•„ì§ˆìˆ˜ë¡ ë°±í˜ˆë³‘ ì„¸í¬ê°€ ê´€ì¸¡ë  í™•ë¥  ë†’ì•„ì§.\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```\nnp.float64(3.1278444454718357e-44)\n```\n:::\n:::\n\n\n## ë¬¸ì œ 7\n\nCELL ë³€ìˆ˜ì˜ 99% ì˜¤ì¦ˆë¹„ì— ëŒ€í•œ ì‹ ë¢°êµ¬ê°„ì„ êµ¬í•˜ì‹œì˜¤.\n\n::: {#6340ec91 .cell execution_count=7}\n``` {.python .cell-code}\n# CELL ë³€ìˆ˜ì˜ ë² íƒ€ì— ëŒ€í•œ 99 : (ë² íƒ€_hat - z(0.005)*SE(std_err) , ë² íƒ€_hat + z(0.005)*SE)\nfrom scipy.stats import norm\nz0005 = norm.ppf(0.995, loc=0, scale=1)\n30.8301 - 52.135*z0005 , 30.8301 + 52.135*z0005\nnp.exp(30.8301 - 52.135*z0005) , np.exp(30.8301 + 52.135*z0005)  # (1.1683218982002717e-45, 5.141881884993857e+71)\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n```\n(np.float64(1.1683218982002717e-45), np.float64(5.141881884993857e+71))\n```\n:::\n:::\n\n\n## ë¬¸ì œ 8\n\nì£¼ì–´ì§„ ë°ì´í„°ì— ëŒ€í•˜ì—¬ ë¡œì§€ìŠ¤í‹± íšŒê·€ ëª¨ë¸ì˜ ì˜ˆì¸¡ í™•ë¥ ì„ êµ¬í•œ í›„ 50% ì´ìƒì¸ ê²½ìš° 1ë¡œ ì²˜ë¦¬í•˜ì—¬, í˜¼ë™ í–‰ë ¬ë¥¼ êµ¬í•˜ì‹œì˜¤.\n\n::: {#c7c73f36 .cell execution_count=8}\n``` {.python .cell-code}\nfrom sklearn.metrics import confusion_matrix, ConfusionMatrixDisplay\nimport matplotlib.pyplot as plt\n\ny_pred = model.predict(train)\nresult = pd.DataFrame({'y_pred' : y_pred})\nresult['result'] = np.where(result['y_pred']>=0.5, 1,0)\n\nconf_mat = confusion_matrix(y_true = df['REMISS'], y_pred = result['result'], labels=[1,0])\np = ConfusionMatrixDisplay(confusion_matrix = conf_mat, display_labels = ('ê´€ì¸¡ë¶ˆê°€_1', 'ê´€ì¸¡ê°€ëŠ¥_0'))\nplt.rcParams['font.family'] = 'Malgun Gothic'\np.plot(cmap=\"Blues\")\n```\n\n::: {.cell-output .cell-output-display}\n![](Logistic_Regression_files/figure-html/cell-9-output-1.png){width=551 height=430}\n:::\n:::\n\n\n## ë¬¸ì œ 9\n\ní•´ë‹¹ ëª¨ë¸ì˜ AccuracyëŠ” ì–¼ë§ˆì¸ê°€ìš”?\n\n::: {#47cd0c73 .cell execution_count=9}\n``` {.python .cell-code}\n(5+15)/(5+3+4+15)  # 0.7407407407407407\n\nfrom sklearn.metrics import accuracy_score, f1_score\naccuracy_score(df['REMISS'], result['result'])  # 0.7407407407407407\n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n```\n0.7407407407407407\n```\n:::\n:::\n\n\n## ë¬¸ì œ 10\n\ní•´ë‹¹ ëª¨ë¸ì˜ F1 Scoreë¥¼ êµ¬í•˜ì„¸ìš”.\n\n::: {#cd4bb1c0 .cell execution_count=10}\n``` {.python .cell-code}\nprecision = 5/(5+3)\nrecall = 5/(5+4)\n\n2 / (1/precision + 1/recall)   # 0.5882352941176471\n\nf1_score(df['REMISS'], result['result'])  # 0.5882352941176471\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n```\nnp.float64(0.5882352941176471)\n```\n:::\n:::\n\n\n",
    "supporting": [
      "Logistic_Regression_files"
    ],
    "filters": [],
    "includes": {}
  }
}